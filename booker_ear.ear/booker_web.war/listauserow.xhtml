<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="title">Lista użytkowników</ui:define>
	
	<ui:define name="viewname">
		<li><p:link outcome="/listauserow">Lista użytkowników</p:link></li>
	</ui:define>
	
	<f:metadata>
   	<f:viewAction action="#{userlistaBB.f5test}" onPostBack="true"/>
	</f:metadata>

	<ui:define name="content">
		<div class="grid table-demo">
			<div class="col-12">
				<div class="card">
					<h5>Lista użytkowników</h5>
					<h:form id="form">
						<p:dataTable var="user" value="#{userlistaBB.user}"
							widgetVar="usertabela" rows="15" paginator="true"
							paginatorPosition="both"
							paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							currentPageReportTemplate="{startRecord}-{endRecord} z {totalRecords} spotkań"
							rowsPerPageTemplate="10,15,20,30,50" stripedRows="true">

							<p:column headerText="Imię i nazwisko" sortBy="#{user.username}"
								filterBy="#{user.username}" filterMatchMode="contains">
								<h:outputText value="#{user.username}" />
							</p:column>
							<p:column headerText="Adres email" sortBy="#{user.email}"
								filterBy="#{user.email}" filterMatchMode="contains">
								<h:outputText value="#{user.email}" />
							</p:column>
							<p:column headerText="Lokalizacja" sortBy="#{user.site.nazwa}"
								filterBy="#{user.site.nazwa}" filterMatchMode="contains">
								<h:outputText value="#{user.site.nazwa}" />
							</p:column>
							<p:column headerText="Adres lokalizacji"
								sortBy="#{user.site.lokalizacja}"
								filterBy="#{user.site.lokalizacja}" filterMatchMode="contains">
								<h:outputText value="#{user.site.lokalizacja}" />
							</p:column>
							<p:column headerText="Uprawnienia" sortBy="#{user.rola}"
								field="rola" filterMatchMode="contains">
								<f:facet name="filter">
									<p:selectOneMenu onchange="PF('usertabela').filter()"
										styleClass="ui-custom-filter">
										<f:selectItem itemLabel="(Wszystkie)" itemValue="#{null}"
											noSelectionOption="true" />
										<f:selectItem itemLabel="Administrator" itemValue="Admin" />
										<f:selectItem itemLabel="Użytkownik" itemValue="User" />
									</p:selectOneMenu>
								</f:facet>
								<h:outputText value="#{user.rola}" />
							</p:column>
							<!--  tu chcemy wyszukiwanie z checkboxem -->
							<p:column headerText="Aktywność" sortBy="#{user.active}"
								field="active" filterMatchMode="contains">
								<f:facet name="filter">
									<p:selectOneMenu onchange="PF('usertabela').filter()"
										styleClass="ui-custom-filter">
										<f:selectItem itemLabel="(Wszystkie)" itemValue="#{null}"
											noSelectionOption="true" />
										<f:selectItem itemLabel="Aktywny" itemValue="1" />
										<f:selectItem itemLabel="Nieaktywny" itemValue="0" />
									</p:selectOneMenu>
								</f:facet>
								<h:outputText value="Aktywny" rendered="#{user.active == 1}" />
								<h:outputText value="Nieaktywny" rendered="#{user.active == 0}" />

							</p:column>
							<!--  tu chcemy kolumnę usuń guzik rendered tylko dla nie-adminów w wyniku -->
							<p:column headerText="" style="width: 100px; text-align: center">
								<p:commandButton type="submit" value="Dezaktywuj"
									styleClass="ui-button-outlined ui-button-danger"
									style="width: 100px"
									action="#{userlistaBB.switchActivity(user)}"
									rendered="#{user.active == 1}" ajax="false" />
								<p:commandButton type="submit" value="Aktywuj"
									styleClass="ui-button-outlined ui-button-success"
									style="width: 100px"
									action="#{userlistaBB.switchActivity(user)}"
									rendered="#{user.active == 0}" ajax="false" />

							</p:column>
							<p:column headerText="" style="width: 100px">
								<p:commandButton value="Reset hasła"
									styleClass="rounded-button ui-button"
									action="#{userlistaBB.pReset(user)}"/>
							</p:column>
							<p:column headerText="" style="width: 100px">
								<p:commandButton type="submit" value="Usuń użytkownika"
									styleClass="rounded-button ui-button-danger"
									action="#{userlistaBB.userDrop(user)}"
									rendered="#{user.rola != 'Admin'}" ajax="false" />
							</p:column>

						</p:dataTable>
					</h:form>
				</div>
			</div>
		</div>
	</ui:define>

</ui:composition>